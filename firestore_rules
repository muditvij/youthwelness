rules_version = '2';

service cloud.firestore {
match /databases/{database}/documents {

// All app data is stored under a main "artifacts" collection.
match /artifacts/{appId} {

  // User profiles, which include stats for badges, are stored at:
  // /artifacts/{appId}/users/{userId}
  match /users/{userId} {
    // A user can read, update, and create their own profile.
    // This is crucial for retrieving display names, stats, and saving preferences.
    // No one else can access this information.
    allow read, update, create: if request.auth != null && request.auth.uid == userId;
  }

  // Mood data, including the notes array, is stored under:
  // /artifacts/{appId}/moods/{userId}/days/{dayId}
  match /moods/{userId}/{documents=**} {
    // A user has full read and write access ONLY to their own mood data.
    // The `write` permission allows creating entries and updating the `notes` array.
    allow read, write: if request.auth != null && request.auth.uid == userId;
  }

  // Chat messages are stored in a subcollection under the user's ID:
  // /artifacts/{appId}/chats/{userId}/messages/{messageId}
  match /chats/{userId}/{documents=**} {
    // A user has full read and write access ONLY to their own chat history.
    // This secures their conversations with the AI buddy.
    allow read, write: if request.auth != null && request.auth.uid == userId;
  }
}

}
}
